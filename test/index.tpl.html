<html>
<head>
    <meta charset="utf-8">
    <title>Mocha Tests</title>
    <link rel="stylesheet" href="../node_modules/mocha/mocha.css"/>
    <script src="../node_modules/jquery/dist/jquery.js"></script>
    <script src="../node_modules/mocha/mocha.js"></script>
    <script src="../node_modules/underscore/underscore.js"></script>
    <script src="../node_modules/async/lib/async.js"></script>
    <script src="../node_modules/chai/chai.js"></script>
    <script src="../node_modules/sinon/pkg/sinon.js"></script>
    <script src="../node_modules/pouchdb/dist/pouchdb.js"></script>
    <script src="../node_modules/pouchdb/dist/pouchdb.memory.js"></script>
    <script src="../build/siesta.js"></script>
    <script>mocha.setup('bdd')</script>
    <!-- specs --><% specs.forEach( function ( file ) { %>
    <script type="text/javascript" src="<%= file %>"></script>
    <% }); %>


    <script>
        onload = function () {
            mocha.globals(['jQuery']);
            var runner = mocha.run();
//        if (navigator.userAgent.indexOf('PhantomJS') < 0) {
//            var runner = mocha.run();
//
//            var failedTests = [];
//            runner.on('end', function () {
//                window.mochaResults = runner.stats;
//                window.mochaResults.reports = failedTests;
//            });
//
//            runner.on('fail', logFailure);
//
//            function logFailure(test, err) {
//
//                var flattenTitles = function (test) {
//                    var titles = [];
//                    while (test.parent.title) {
//                        titles.push(test.parent.title);
//                        test = test.parent;
//                    }
//                    return titles.reverse();
//                };
//
//                failedTests.push({name: test.title, result: false, message: err.message, stack: err.stack, titles: flattenTitles(test) });
//            }
//        }


        };
    </script>
</head>
<body>
<div id="mocha"></div>
</body>
</html>
